<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>게임 거래소 - 출석체크</title>
  <!-- 공통 아이템 데이터 로드 (캐싱 방지) -->
  <script src="/js/itemsData.js?v=1.1"></script>
  <!-- 인증 관리 시스템 - 실시간 로그인 상태 동기화 -->
  <script src="/js/auth.js?v=1.0"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* 기본 스타일 */
    body {
      font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
      background-color: #f8f9fa;
      color: #333;
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }
    
    /* 아이콘 크기 제한 */
    svg {
      max-width: 24px;
      max-height: 24px;
      width: 24px;
      height: 24px;
    }
    
    /* 보상 섹션의 작은 아이콘 */
    .reward-icon {
      font-size: 20px;
      display: inline-block;
      width: 30px;
      height: 30px;
      line-height: 30px;
      text-align: center;
      margin-right: 10px;
    }
    
    /* 모달의 이모티콘 크기 */
    .modal-icon {
      font-size: 36px;
      margin-bottom: 15px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 15px;
    }
    
    /* 헤더 */
    header {
      background-color: white;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      padding: 15px 0;
      margin-bottom: 20px;
    }
    
    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      display: flex;
      align-items: center;
      text-decoration: none;
      color: #333;
      font-weight: bold;
      font-size: 18px;
    }
    
    .logo svg {
      margin-right: 10px;
    }
    
    .main-nav ul {
      display: flex;
      list-style: none;
      margin: 0;
      padding: 0;
    }
    
    .main-nav li {
      margin-left: 20px;
    }
    
    .main-nav a {
      text-decoration: none;
      color: #555;
      font-weight: 500;
    }
    
    .main-nav a.active {
      color: #4569d4;
    }
    
    /* 출석 알림박스 */
    .attendance-alert {
      display: flex;
      align-items: center;
      background-color: #e8f5e9;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    }
    
    .attendance-alert svg {
      margin-right: 16px;
      flex-shrink: 0;
    }
    
    /* 캘린더 섹션 */
    .calendar-section {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    
    /* 캘린더 헤더 */
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .month-nav {
      display: flex;
      align-items: center;
    }
    
    .month-display {
      font-size: 20px;
      font-weight: bold;
      margin: 0 15px;
    }
    
    /* 버튼 스타일 */
    .btn {
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background-color: #4569d4;
      color: white;
      border: none;
    }
    
    .btn-primary:hover {
      background-color: #3a5bc0;
    }
    
    .btn-outline {
      background-color: white;
      border: 1px solid #ddd;
      color: #555;
    }
    
    .btn-outline:hover {
      background-color: #f5f5f5;
    }
    
    /* 선택 박스 스타일 */
    .select-box {
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid #ddd;
      font-size: 14px;
      background-color: white;
      cursor: pointer;
      margin-right: 8px;
    }
    
    /* 캘린더 테이블 */
    .calendar-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }
    
    .calendar-table th {
      padding: 10px;
      text-align: center;
      font-weight: 500;
      border-bottom: 1px solid #eee;
    }
    
    .calendar-table th.sun {
      color: #e74c3c;
    }
    
    .calendar-table th.sat {
      color: #3498db;
    }
    
    .calendar-table td {
      padding: 0;
      border: 1px solid #eee;
      height: 100px; /* 모든 셀 동일한 크기 */
      width: calc(100% / 7); /* 전체 너비의 1/7 */
      position: relative; /* 날짜와 체크표시 배치를 위한 기준점 */
      vertical-align: top;
      transition: background-color 0.2s;
    }
    
    .calendar-table td:hover {
      background-color: #f9f9f9;
    }
    
    .date-number {
      font-size: 16px;
      font-weight: 500;
      position: absolute;
      top: 5px;
      left: 8px;
      margin: 0;
    }
    
    /* 출석체크 표시 스타일 */
    .attendance-check {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 32px;
      color: #4caf50;
      z-index: 1;
    }
    
    td.sun .date-number {
      color: #e74c3c;
    }
    
    td.sat .date-number {
      color: #3498db;
    }
    
    td.today {
      background-color: #e3f2fd;
      border: 1px solid #90caf9;
    }
    
    td.other-month .date-number {
      color: #bbb;
    }
    
    /* 출석체크 표시 */
    td.checked::after {
      content: '✓';
      display: block;
      width: 24px;
      height: 24px;
      background-color: #4569d4;
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 24px;
      margin: 5px auto 0;
      font-weight: bold;
    }
    
    /* 출석체크 버튼 영역 */
    .check-in-area {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #eee;
      text-align: center;
    }
    
    /* 출석 종류에 따른 아이콘 스타일 */
    .attendance-icon {
      width: 30px;
      height: 30px;
      margin-right: 10px;
    }
    
    .attendance-status {
      margin-top: 10px;
      color: #666;
      font-size: 14px;
    }
    
    .streak-count {
      font-weight: bold;
      color: #4569d4;
    }
    
    /* 드롭다운 메뉴 스타일 */
    .dropdown-menu {
      position: relative;
      display: inline-block;
    }
    
    .dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      top: 100%;
      background-color: white;
      min-width: 160px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      border-radius: 0.375rem;
      z-index: 10;
      margin-top: 0.5rem;
    }
    
    .dropdown-content.show, #userDropdown.show {
      display: block !important;
    }
    
    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #333;
      padding: 12px 16px;
      text-decoration: none;
      border-bottom: 1px solid #e5e7eb;
      transition: background-color 0.2s;
    }
    
    .dropdown-item:last-child {
      border-bottom: none;
    }
    
    .dropdown-item:hover {
      background-color: #f3f4f6;
    }
    
    .dropdown-item svg {
      margin-right: 8px;
      width: 18px;
      height: 18px;
    }
    
    /* 보상 섹션 */
    .rewards-section {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    
    .reward-item {
      display: flex;
      align-items: flex-start;
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid #eee;
    }
    
    .reward-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .reward-day {
      width: 36px;
      height: 36px;
      background-color: #fff3e0;
      color: #f57c00;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 12px;
      flex-shrink: 0;
    }
    
    .reward-content {
      flex: 1;
    }
    
    .reward-title {
      font-weight: bold;
      margin-bottom: 2px;
    }
    
    .reward-description {
      font-size: 14px;
      color: #666;
    }
    
    /* 이미지 크기 제한 */
    img, svg {
      max-width: 100%;
      height: auto;
    }
    
    /* 드롭다운 메뉴 스타일 */
    .menu-dropdown {
      position: relative;
      display: inline-block;
    }
    
    .menu-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      color: #555;
      border-radius: 4px;
      display: flex;
      align-items: center;
      transition: all 0.2s;
    }
    
    .menu-btn:hover {
      background-color: #f0f0f0;
    }
    
    .dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      top: 100%;
      background-color: white;
      min-width: 180px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
      border-radius: 4px;
      z-index: 1000;
      overflow: hidden;
    }
    
    .dropdown-content.show {
      display: block;
      animation: fadeIn 0.2s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .dropdown-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      text-decoration: none;
      color: #333;
      transition: all 0.2s;
    }
    
    .dropdown-item svg {
      margin-right: 8px;
    }
    
    .dropdown-item:hover {
      background-color: #f5f7fa;
    }
    
    /* 반응형 디자인 */
    @media (max-width: 768px) {
      .calendar-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .month-selectors {
        margin-top: 10px;
      }
      
      .calendar-table td {
        height: 60px;
        padding: 5px;
      }
      
      .date-number {
        font-size: 14px;
      }
    }
    /* 드롭다운 메뉴 스타일 */
    .dropdown-content {
      display: none;
      position: absolute;
      right: 15px;
      top: 55px;
      background-color: white;
      border-radius: 4px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      min-width: 200px;
      z-index: 100;
    }
    
    .dropdown-content.show {
      display: block;
    }
    
    .dropdown-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      text-decoration: none;
      color: #333;
      border-bottom: 1px solid #f1f1f1;
      transition: background-color 0.2s;
    }
    
    .dropdown-item:hover {
      background-color: #f5f5f5;
    }
    
    .dropdown-item svg {
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <!-- 헤더 -->
  <header class="site-header" style="background-color: #673ab7; color: white;">
    <div class="container mx-auto px-4">
      <div class="flex justify-between items-center py-3">
        <a href="index.html" class="flex items-center">
          <h1 class="text-xl font-bold">게임 거래소 홈</h1>
        </a>
        
        <!-- 상단 메뉴 -->
        <div class="flex items-center space-x-5 text-sm">
          <a href="market.html" class="text-white hover:text-gray-200">거래소</a>
          <a href="board.html" class="text-white hover:text-gray-200">게시판</a>
          <a href="attendance.html" class="text-white hover:text-gray-200 font-bold">출석체크</a>
          <a href="profile.html" class="text-white hover:text-gray-200" id="profileLink">프로필</a>
          <a href="login.html" class="text-white hover:text-gray-200 hidden" id="loginBtn">로그인</a>
          <div id="userCurrencyDisplay" class="text-white px-2 py-1 rounded bg-purple-800 hidden"></div>
          <button id="menuButton" class="text-white hover:text-gray-200">
            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- 드롭다운 메뉴 -->
  <div id="userDropdown" class="dropdown-content" style="display: none; position: absolute; right: 15px; top: 55px; background-color: white; border-radius: 4px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); min-width: 200px; z-index: 1000;">
    <a href="market.html" class="dropdown-item" style="display: flex; align-items: center; padding: 12px 16px; text-decoration: none; color: #333; border-bottom: 1px solid #f1f1f1;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 0v10"></path>
      </svg>
      거래소
    </a>
    <a href="board.html" class="dropdown-item" style="display: flex; align-items: center; padding: 12px 16px; text-decoration: none; color: #333; border-bottom: 1px solid #f1f1f1;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
      </svg>
      게시판
    </a>
    <a href="attendance.html" class="dropdown-item" style="display: flex; align-items: center; padding: 12px 16px; text-decoration: none; color: #333; border-bottom: 1px solid #f1f1f1;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
      </svg>
      출석체크
    </a>
    <a href="profile.html" class="dropdown-item" style="display: flex; align-items: center; padding: 12px 16px; text-decoration: none; color: #333; border-bottom: 1px solid #f1f1f1;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 10px;">
        <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
      </svg>
      사용자정보
    </a>
    <a href="inventory.html" class="dropdown-item" style="display: flex; align-items: center; padding: 12px 16px; text-decoration: none; color: #333; border-bottom: 1px solid #f1f1f1;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 10px;">
        <path d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path>
      </svg>
      인벤토리
    </a>
    <a href="#" id="logoutBtn" class="dropdown-item" style="display: flex; align-items: center; padding: 12px 16px; text-decoration: none; color: #333; border-bottom: 1px solid #f1f1f1;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 10px;">
        <path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
      </svg>
      로그아웃
    </a>
    </div>
  </div>

  <main class="container">
    <!-- 출석 알림박스 -->
    <div class="attendance-alert">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4caf50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
      <div>
        <h3 style="margin: 0 0 5px 0; font-size: 16px;">오늘의 출석체크를 완료하세요</h3>
        <p style="margin: 0; font-size: 14px;">매일 출석체크를 하면 특별한 보상을 받을 수 있습니다.</p>
      </div>
    </div>

    <!-- 메인 콘텐츠 레이아웃 -->
    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
      <!-- 캘린더 섹션 -->
      <div class="calendar-section" style="flex: 1; min-width: 300px;">
        <!-- 출석체크 버튼 상단 배치 -->
        <div style="margin-bottom: 20px;">
          <button id="checkInButton" class="btn btn-primary" style="width: 100%; padding: 12px; background-color: #4569d4; color: white; border: none; border-radius: 4px; font-weight: bold; cursor: pointer;">
            오늘 출석체크하기
          </button>
          <div class="attendance-status" style="margin-top: 10px; text-align: center; font-size: 14px; color: #555;">
            현재 연속 출석: <span id="streakCount" class="streak-count" style="font-weight: bold; color: #4569d4;">0</span>일
          </div>
        </div>
        
        <!-- 캘린더 헤더 -->
        <div class="calendar-header">
          <div class="month-nav" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
            <button id="prevMonth" class="btn btn-outline" style="padding: 8px 12px; background: transparent; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
              이전 달
            </button>
            <button id="nextMonth" class="btn btn-outline" style="padding: 8px 12px; background: transparent; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
              다음 달
            </button>
          </div>
          
          <div class="month-selectors" style="display: flex; gap: 10px; margin-bottom: 15px;">
            <select id="yearSelect" class="select-box" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; flex-grow: 1;">
              <!-- JavaScript로 옵션 추가 -->
            </select>
            <select id="monthSelect" class="select-box" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; flex-grow: 1;">
              <option value="0">1월</option>
              <option value="1">2월</option>
              <option value="2">3월</option>
              <option value="3">4월</option>
              <option value="4">5월</option>
              <option value="5">6월</option>
              <option value="6">7월</option>
              <option value="7">8월</option>
              <option value="8">9월</option>
              <option value="9">10월</option>
              <option value="10">11월</option>
              <option value="11">12월</option>
            </select>
          </div>
        </div>
        
        <!-- 캘린더 테이블 -->
        <table class="calendar-table" style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
          <thead>
            <tr>
              <th class="sun" style="padding: 10px; text-align: center; font-weight: 500; color: #e53935;">일</th>
              <th style="padding: 10px; text-align: center; font-weight: 500;">월</th>
              <th style="padding: 10px; text-align: center; font-weight: 500;">화</th>
              <th style="padding: 10px; text-align: center; font-weight: 500;">수</th>
              <th style="padding: 10px; text-align: center; font-weight: 500;">목</th>
              <th style="padding: 10px; text-align: center; font-weight: 500;">금</th>
              <th class="sat" style="padding: 10px; text-align: center; font-weight: 500; color: #1e88e5;">토</th>
            </tr>
          </thead>
          <tbody id="calendarBody">
            <!-- JavaScript로 동적 생성 -->
          </tbody>
        </table>
        
        <!-- 안내 메시지 -->
        <div style="margin-top: 20px; text-align: center; font-size: 14px; color: #777;">
          매일 자정에 출석체크가 초기화됩니다.
        </div>
      </div>

      <!-- 보상 섹션 -->
      <div class="rewards-section" style="flex: 1; min-width: 300px; background-color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); padding: 20px;">
        <div class="section-title" style="font-size: 18px; font-weight: bold; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee;">출석 보상</div>
        
        <div class="reward-item" style="display: flex; align-items: center; padding: 15px 0; border-bottom: 1px solid #f1f1f1;">
          <div class="reward-day" style="flex: 0 0 100px; font-weight: 500; color: #4569d4;">매일 출석</div>
          <div class="reward-detail" style="flex: 1;">
            <div style="font-weight: 500; white-space: nowrap;">재화 +100,000</div>
          </div>
          <div class="reward-icon" style="color: #ffc107; font-size: 20px; width: auto; height: auto; text-align: center;">⭐</div>
        </div>
        
        <div class="reward-item" style="display: flex; align-items: center; padding: 15px 0; border-bottom: 1px solid #f1f1f1;">
          <div class="reward-day" style="flex: 0 0 100px; font-weight: 500; color: #4569d4;">7일 연속</div>
          <div class="reward-detail" style="flex: 1;">
            <div style="font-weight: 500; white-space: nowrap;">재화 +200,000 + 랜덤 재화 박스</div>
          </div>
          <div class="reward-icon" style="color: #4caf50; font-size: 20px; width: auto; height: auto; text-align: center;">🎁</div>
        </div>
        
        <div class="reward-item" style="display: flex; align-items: center; padding: 15px 0; border-bottom: 1px solid #f1f1f1;">
          <div class="reward-day" style="flex: 0 0 100px; font-weight: 500; color: #4569d4;">15일 연속</div>
          <div class="reward-detail" style="flex: 1;">
            <div style="font-weight: 500; white-space: nowrap;">재화 +300,000 + 랜덤 재화 박스</div>
          </div>
          <div class="reward-icon" style="color: #9c27b0; font-size: 20px; width: auto; height: auto; text-align: center;">🎁</div>
        </div>
        
        <div class="reward-item" style="display: flex; align-items: center; padding: 15px 0;">
          <div class="reward-day" style="flex: 0 0 100px; font-weight: 500; color: #4569d4;">30일 연속</div>
          <div class="reward-detail" style="flex: 1;">
            <div style="font-weight: 500; white-space: nowrap;">재화 +500,000 + 랜덤 재화 박스</div>
          </div>
          <div class="reward-icon" style="color: #ff5722; font-size: 20px; width: auto; height: auto; text-align: center;">🎁</div>
        </div>
        
        <!-- 랜덤 재화 박스 확률 설명 -->
        <div style="margin-top: 20px; padding: 15px; background-color: #f9f9f9; border-radius: 4px;">
          <div style="font-weight: 500; margin-bottom: 10px; color: #333;">랜덤 재화 박스 확률 정보</div>
          <div style="font-size: 13px; color: #666;">
            <div style="margin-bottom: 5px;"><span style="font-weight: 500; color: #4569d4;">40%</span> 확률로 <span style="font-weight: 500;">100,000</span> 재화</div>
            <div style="margin-bottom: 5px;"><span style="font-weight: 500; color: #4569d4;">30%</span> 확률로 <span style="font-weight: 500;">200,000</span> 재화</div>
            <div style="margin-bottom: 5px;"><span style="font-weight: 500; color: #4569d4;">20%</span> 확률로 <span style="font-weight: 500;">300,000</span> 재화</div>
            <div style="margin-bottom: 5px;"><span style="font-weight: 500; color: #4569d4;">9%</span> 확률로 <span style="font-weight: 500;">400,000</span> 재화</div>
            <div><span style="font-weight: 500; color: #ff5722;">1%</span> 확률로 <span style="font-weight: 500;">500,000</span> 재화</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 자바스크립트 -->
  <script>
    // DOM 있는지 확인하는 함수
    function ready(fn) {
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        setTimeout(fn, 1);
      } else {
        document.addEventListener('DOMContentLoaded', fn);
      }
    }
    
    ready(function() {
      // DOM 요소 참조
      const menuButton = document.getElementById('menuButton');
      const userDropdown = document.getElementById('userDropdown');
      
      console.log('메뉴 버튼 참조:', menuButton);
      console.log('드롭다운 참조:', userDropdown);
      
      // 사용자 로그인 상태 체크
      const user = JSON.parse(localStorage.getItem('user') || 'null');
      const loginBtn = document.getElementById('loginBtn');
      let logoutBtn = document.getElementById('logoutBtn');
      let profileLink = document.getElementById('profileLink');
      
      if (user) {
        // 로그인 상태인 경우
        if (loginBtn) loginBtn.classList.add('hidden');
        if (profileLink) profileLink.classList.remove('hidden');

        // 로그아웃 버튼 이벤트
        if (logoutBtn) {
          logoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            localStorage.removeItem('user');
            alert('로그아웃 되었습니다.');
            window.location.reload();
          });
        }
      } else {
        // 비로그인 상태인 경우
        if (loginBtn) loginBtn.classList.remove('hidden');
        if (profileLink) profileLink.classList.add('hidden');
      }
      
      // 메뉴 버튼 클릭 이벤트
      if (menuButton) {
        menuButton.addEventListener('click', function(e) {
          console.log('메뉴 버튼 클릭됨!');
          e.preventDefault();
          e.stopPropagation();
          if (userDropdown) {
            // display 속성 직접 조절 (classList.toggle 대신)
            if (userDropdown.style.display === 'none' || userDropdown.style.display === '') {
              userDropdown.style.display = 'block';
            } else {
              userDropdown.style.display = 'none';
            }
          }
        });
      }
      
      // 외부 영역 클릭 시 메뉴 드롭다운 닫기
      document.addEventListener('click', function(e) {
        if (userDropdown && userDropdown.style.display === 'block') {
          // 클릭된 요소가 메뉴 버튼이나 드롭다운 내부가 아닌 경우 드롭다운 닫기
          if (!menuButton.contains(e.target) && !userDropdown.contains(e.target)) {
            userDropdown.style.display = 'none';
          }
        }
      });
      
      console.log('메뉴 버튼 이벤트 등록 완료');
      
      // 로그아웃 버튼 이벤트 처리
      // 중복 선언 오류를 피하기 위해 이미 로그아웃 버튼 이벤트를 위에서 처리했으니 여기서는 제외
      
      // 출석체크 시스템 초기화
      initializeAttendanceSystem();
    });

    // 전역 변수
    const today = new Date();
    today.setHours(12, 0, 0, 0); // 정확한 날짜 비교를 위해 시간 고정
    
    // 현재 연도와 월 저장
    let currentYear = today.getFullYear();
    let currentMonth = today.getMonth();
    
    // 사용자 데이터 가져오기 (로컬 스토리지)
    function getUserData() {
      const savedUserData = localStorage.getItem('user');
      if (savedUserData) {
        return JSON.parse(savedUserData);
      }
      
      // 사용자 데이터가 없는 경우 기본값 설정
      const defaultUserData = {
        username: '사용자',
        currency: 0,
        items: []
      };
      localStorage.setItem('user', JSON.stringify(defaultUserData));
      return defaultUserData;
    }
    
    // 사용자 데이터 저장하기
    function saveUserData(userData) {
      localStorage.setItem('user', JSON.stringify(userData));
    }
    
    // 포맷팅된 날짜 키 생성 함수 추가
    function formatDateKey(year, month, day) {
      return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    }
    
    // 사용자 출석 데이터 가져오기 (로컬 스토리지)
    function getUserAttendanceData() {
      const savedData = localStorage.getItem('attendanceData');
      
      // 사용자 로그인 데이터
      const user = getUserData();
      const username = user ? user.username : 'guest';
      
      if (savedData) {
        try {
          const parsedData = JSON.parse(savedData);
          
          // 사용자별 관리
          if (parsedData[username]) {
            // dates 객체가 존재하는지 확인
            if (!parsedData[username].dates) {
              parsedData[username].dates = {};
            }
            return parsedData[username];
          }
        } catch (e) {
          console.error('출석 데이터 파싱 오류', e);
        }
      }
      
      // 기본 데이터 생성
      return {
        streak: 0,
        lastCheckIn: null,
        dates: {}
      };
    }
    
    // 출석 데이터 저장
    function saveAttendanceData(data) {
      try {
        // 현재 사용자 정보 확인
        const user = getUserData();
        if (!user || !user.username) {
          console.error('저장할 사용자 정보가 없습니다.');
          return false;
        }
        
        // 로컬 스토리지 키 생성
        const storageKey = `attendance_${user.username}`;
        
        // 저장할 데이터 개체 준비
        const dataToSave = data || getUserAttendanceData();
        
        // 로컬 스토리지에 저장
        localStorage.setItem(storageKey, JSON.stringify(dataToSave));
        
        // API 엔드포인트로 데이터 전송 (서버에 실시간 저장)
        sendAttendanceToServer(user.username, dataToSave);
        
        console.log('출석 데이터 저장 및 서버 전송 완료:', dataToSave);
        return true;
      } catch (error) {
        console.error('출석 데이터 저장 중 오류 발생:', error);
        return false;
      }
    }
    
    // 서버에 출석 데이터 전송 함수
    function sendAttendanceToServer(username, attendanceData) {
      try {
        // 서버에 데이터 전송
        const apiUrl = '/api/attendance/save';
        
        // 전송할 데이터 구성
        const requestData = {
          username: username,
          attendanceData: attendanceData,
          timestamp: new Date().toISOString()
        };
        
        console.log('서버에 출석 데이터 전송 중:', requestData);
        
        // Fetch API를 통한 비동기 전송
        fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(requestData)
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Server response was not ok');
          }
          return response.json();
        })
        .then(data => {
          console.log('출석 데이터 서버 저장 성공:', data);
        })
        .catch(error => {
          console.error('출석 데이터 서버 저장 실패:', error);
          // 실패 시 재시도 로직 추가 가능
          setTimeout(() => {
            console.log('서버 저장 재시도 예약...');
            // 재시도 로직은 예시로 주석 처리
            // retryServerSave(username, attendanceData);
          }, 30000); // 30초 후 재시도
        });
      } catch (error) {
        console.error('서버 전송 중 오류 발생:', error);
      }
    }
    
    // 출석 데이터
    let attendanceData = getUserAttendanceData();
    
    // 출석체크 시스템 초기화
    function initializeAttendanceSystem() {
      // 연도 선택 상자 초기화
      populateYearOptions();
      
      // 연도/월 선택 상자 값 설정
      document.getElementById('yearSelect').value = currentYear;
      
      // 캘린더 생성
      generateCalendar(currentYear, currentMonth);
      
      // 연속 출석 표시
      document.getElementById('streakCount').textContent = attendanceData.streak;
      
      // 출석체크 버튼 이벤트 리스너
      const checkInButton = document.getElementById('checkInButton');
      if (checkInButton) {
        checkInButton.addEventListener('click', function() {
          console.log('출석체크 버튼 클릭됨');
          checkAttendance();
        });
      } else {
        console.error('출석체크 버튼을 찾을 수 없습니다');
      }
      
      // 달력 탐색 버튼 이벤트 리스너
      setupCalendarNavigationListeners();
    }
    
    // 연도 선택 상자 옵션 추가
    function populateYearOptions() {
      const yearSelect = document.getElementById('yearSelect');
      yearSelect.innerHTML = '';
      
      const currentYear = new Date().getFullYear();
      for (let year = currentYear - 2; year <= currentYear + 2; year++) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = `${year}년`;
        yearSelect.appendChild(option);
      }
    }
    
    // 달력 탐색 버튼 이벤트 리스너 설정
    function setupCalendarNavigationListeners() {
      // 이전 달 버튼
      document.getElementById('prevMonth').addEventListener('click', function() {
        console.log('이전 달 버튼 클릭');
        currentMonth--;
        if (currentMonth < 0) {
          currentMonth = 11;
          currentYear--;
        }
        console.log('변경 후 연도/월:', currentYear, currentMonth);
        generateCalendar(currentYear, currentMonth);
        updateMonthYearDisplay();
      });
      
      // 다음 달 버튼
      document.getElementById('nextMonth').addEventListener('click', function() {
        console.log('다음 달 버튼 클릭');
        currentMonth++;
        if (currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        }
        console.log('변경 후 연도/월:', currentYear, currentMonth);
        // 다음 달 버튼에서는 generateCalendar 와 updateMonthYearDisplay 호출
        generateCalendar(currentYear, currentMonth);
        updateMonthYearDisplay();
      });
      
      // 연도 선택 상자 변경 이벤트
      document.getElementById('yearSelect').addEventListener('change', function() {
        console.log('연도 선택 변경');
        currentYear = parseInt(this.value);
        // 링크/선택박스 변경 시 또한 generateCalendar 호출
        generateCalendar(currentYear, currentMonth);
        updateMonthYearDisplay();
      });
      
      // 월 선택 상자 변경 이벤트
      document.getElementById('monthSelect').addEventListener('change', function() {
        console.log('월 선택 변경');
        currentMonth = parseInt(this.value);
        // 링크/선택박스 변경 시 또한 generateCalendar 호출
        generateCalendar(currentYear, currentMonth);
        updateMonthYearDisplay();
      });
    }
    
    // 캘린더 업데이트 - 이 함수는 사용하지 않음 (generateCalendar로 대체)
    function updateCalendar() {
      console.log('updateCalendar 호출 - 이 함수대신 generateCalendar 사용');
      // generateCalendar로 동일하게 작동하도록 수정
      generateCalendar(currentYear, currentMonth);
      updateMonthYearDisplay();
    }
    
    // 선택한 연도와 월에 따라 표시 업데이트
    function updateMonthYearDisplay() {
      // 선택 상자 값 업데이트
      document.getElementById('yearSelect').value = currentYear;
      document.getElementById('monthSelect').value = currentMonth;
      
      // 현재 월 표시 업데이트
      document.getElementById('currentMonth').textContent = `${currentYear}년 ${currentMonth + 1}월`;
      
      // 캘린더 재생성
      generateCalendar(currentYear, currentMonth);
    }
    
    // 캘린더 생성 함수
    function generateCalendar(year, month) {
      console.log('generateCalendar 호출:', year, month);
      const calendarBody = document.getElementById('calendarBody');
      if (!calendarBody) {
        console.error('calendarBody 요소를 찾을 수 없습니다');
        return;
      }
      
      calendarBody.innerHTML = '';
      
      // 해당 월의 첫 날과 마지막 날
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      
      // 첫 주 시작 공백 계산 (일요일: 0, 토요일: 6)
      const firstDayOfWeek = firstDay.getDay();
      
      // 해당 월의 총 날짜 수
      const daysInMonth = lastDay.getDate();
      console.log('이번 달 총 날짜:', daysInMonth);
      
      // 이전 달의 마지막 날짜 구하기
      const prevMonthLastDay = new Date(year, month, 0).getDate();
      
      // 현재 행 초기화
      let currentRow = document.createElement('tr');
      let date = 1;
      let dayCount = 0;
      
      console.log('첫 날 요일:', firstDayOfWeek);
      
      // 이전 달 날짜 채우기
      for (let i = 0; i < firstDayOfWeek; i++) {
        const prevDate = prevMonthLastDay - firstDayOfWeek + i + 1;
        const cell = document.createElement('td');
        cell.className = 'other-month';
        if (i === 0) cell.classList.add('sun');
        if (i === 6) cell.classList.add('sat');
        
        cell.innerHTML = `<span class="date-number">${prevDate}</span>`;
        currentRow.appendChild(cell);
        dayCount++;
      }
      
      // 현재 달 날짜 채우기
      while (date <= daysInMonth) {
        // 새로운 주 시작
        if (dayCount === 7) {
          calendarBody.appendChild(currentRow);
          currentRow = document.createElement('tr');
          dayCount = 0;
        }
        
        const cell = document.createElement('td');
        const dayOfWeek = dayCount;
        
        // 요일에 따른 클래스 추가
        if (dayOfWeek === 0) cell.classList.add('sun');
        if (dayOfWeek === 6) cell.classList.add('sat');
        
        // 셀 기본 스타일 추가 - 모든 셀 동일한 크기로 설정
        cell.style.width = '100px';
        cell.style.height = '100px';
        cell.style.textAlign = 'center';
        cell.style.verticalAlign = 'middle';
        cell.style.border = '1px solid #eaeaea';
        cell.style.position = 'relative';
        cell.style.cursor = 'pointer';
        
        // 현재 날짜인지 확인
        if (year === today.getFullYear() && month === today.getMonth() && date === today.getDate()) {
          cell.classList.add('today');
          cell.style.backgroundColor = '#e3f2fd';
          cell.style.fontWeight = 'bold';
          cell.style.borderRadius = '4px';
        }
        
        // 날짜 표시 - 왼쪽 상단에 배치 (사용자 요청사항)
        const dateSpan = document.createElement('span');
        dateSpan.textContent = date;
        dateSpan.className = 'date-number';
        dateSpan.style.position = 'absolute';
        dateSpan.style.top = '5px';
        dateSpan.style.left = '10px';
        dateSpan.style.fontSize = '16px';
        dateSpan.style.fontWeight = 'normal';
        dateSpan.style.color = (dayOfWeek === 0) ? '#e53935' : (dayOfWeek === 6 ? '#1e88e5' : '#333');
        cell.appendChild(dateSpan);
        
        // 출석체크 했는지 확인
        const dateKey = formatDateKey(year, month, date);
        console.log('날짜 확인:', dateKey, attendanceData.dates && attendanceData.dates[dateKey] ? '출석 O' : '출석 X');
        
        if (attendanceData.dates && attendanceData.dates[dateKey]) {
          // 체크표시 (가운데 배치)
          const checkmark = document.createElement('div');
          checkmark.className = 'attendance-check';
          checkmark.innerHTML = '✓'; // 체크마크 문자
          checkmark.style.position = 'absolute';
          checkmark.style.top = '50%';
          checkmark.style.left = '50%';
          checkmark.style.transform = 'translate(-50%, -50%)';
          checkmark.style.fontSize = '32px';
          checkmark.style.fontWeight = 'bold';
          checkmark.style.color = '#4caf50';
          cell.appendChild(checkmark);
          
          // 출석한 날은 배경색 변경
          cell.style.backgroundColor = '#e8f5e9';
        }
        
        currentRow.appendChild(cell);
        
        date++;
        dayCount++;
      }
      
      // 다음 달 날짜 채우기
      if (dayCount > 0) {
        for (let i = dayCount; i < 7; i++) {
          const cell = document.createElement('td');
          cell.className = 'other-month';
          if (i === 0) cell.classList.add('sun');
          if (i === 6) cell.classList.add('sat');
          
          cell.innerHTML = `<span class="date-number">${i - dayCount + 1}</span>`;
          currentRow.appendChild(cell);
        }
        calendarBody.appendChild(currentRow);
      }
    }
    
    // 출석체크 함수
    function checkAttendance() {
      console.log('출석체크 함수 실행');
      
      // 로그인 여부 확인
      const user = getUserData();
      if (!user || !user.username) {
        alert('출석체크를 위해 로그인이 필요합니다.');
        return;
      }
      
      // 출석 데이터 새로 가져오기 (최신 상태 확인)
      attendanceData = getUserAttendanceData();
      
      // 오늘 날짜 생성
      const today = new Date();
      const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
      console.log('오늘 날짜:', todayStr);
      
      // dates 객체 확인 및 초기화
      if (!attendanceData.dates) {
        attendanceData.dates = {};
      }
      
      // 이미 출석체크 했는지 확인
      if (attendanceData.dates[todayStr]) {
        alert('오늘은 이미 출석체크를 하셨습니다!');
        return;
      }
      
      // 이전 체크인 날짜와 연속성 확인
      const lastCheckDate = attendanceData.lastCheckIn;
      const yesterday = new Date(today);
      yesterday.setDate(yesterday.getDate() - 1);
      const yesterdayStr = `${yesterday.getFullYear()}-${String(yesterday.getMonth() + 1).padStart(2, '0')}-${String(yesterday.getDate()).padStart(2, '0')}`;
      
      console.log('마지막 출석일:', lastCheckDate, '어제:', yesterdayStr);
      
      // 출석 연속성 확인 (어제 체크인 했는지)
      if (lastCheckDate === yesterdayStr) {
        // 연속 출석 유지
        attendanceData.streak++;
      } else {
        // 연속성 끈김 (처음이거나 하루를 건너뛴 경우)
        attendanceData.streak = 1;
      }
      
      // 출석체크 저장 (객체형태로 변경)
      if (!attendanceData.dates) {
        attendanceData.dates = {};
      }
      attendanceData.dates[todayStr] = true;
      attendanceData.lastCheckIn = todayStr;
      
      // 로컬 스토리지에 저장
      saveAttendanceData(attendanceData);
      
      // UI 업데이트
      document.getElementById('streakCount').textContent = attendanceData.streak;
      
      // 캘린더 재생성 (출석체크 표시 업데이트)
      generateCalendar(currentYear, currentMonth);
      
      // 사용자 데이터 가져오기
      let userData = getUserData();
      
      // 보상 분류 및 메시지 결정
      let rewardTitle = '매일 출석 보상';
      let rewardDesc = '재화 +100,000';
      let rewardIcon = '⭐'; // 별 이모티콘
      let rewardPoints = 100000; // 기본 보상 재화
      
      // 특별 보상 확인
      if (attendanceData.streak === 7) {
        rewardTitle = '7일 연속 출석 보상';
        rewardPoints = 200000;
        rewardDesc = '재화 +200,000 + 랜덤 재화 박스';
        rewardIcon = '🎁'; // 선물 이모티콘
        
        // 랜덤 재화 박스 보상 추가
        const randomBoxReward = getRandomBoxReward();
        rewardPoints += randomBoxReward;
        console.log('랜덤 재화 박스 보상:', randomBoxReward);
      } else if (attendanceData.streak === 15) {
        rewardTitle = '15일 연속 출석 보상';
        rewardPoints = 300000;
        rewardDesc = '재화 +300,000 + 랜덤 재화 박스';
        rewardIcon = '🎁'; // 선물 이모티콘
        
        // 랜덤 재화 박스 보상 추가
        const randomBoxReward = getRandomBoxReward();
        rewardPoints += randomBoxReward;
        console.log('랜덤 재화 박스 보상:', randomBoxReward);
      } else if (attendanceData.streak === 30) {
        rewardTitle = '30일 연속 출석 보상';
        rewardPoints = 500000;
        rewardDesc = '재화 +500,000 + 랜덤 재화 박스';
        rewardIcon = '🎁'; // 선물 이모티콘
        
        // 랜덤 재화 박스 보상 추가
        const randomBoxReward = getRandomBoxReward();
        rewardPoints += randomBoxReward;
        console.log('랜덤 재화 박스 보상:', randomBoxReward);
      }
      
      // 사용자 재화 업데이트
      userData.currency = (userData.currency || 0) + rewardPoints;
      console.log('재화 업데이트:', userData.currency);
      
      // 사용자 데이터 저장
      saveUserData(userData);
      
      }
      
      // 랜덤 재화 상자 확률 계산 함수
      function getRandomBoxReward() {
        const random = Math.random() * 100;
        if (random < 40) { // 40% 확률
          return 100000;
        } else if (random < 70) { // 30% 확률
          return 200000;
        } else if (random < 90) { // 20% 확률
          return 300000;
        } else if (random < 99) { // 9% 확률
          return 400000;
        } else { // 1% 확률
          return 500000;
        }
      }
      
      // 커스텀 알림 표시 (모달 형태)
      showRewardAlert(rewardTitle, rewardDesc, rewardIcon);
    
    
    // 보상 알림 함수
    function showRewardAlert(title, desc, icon) {
      // 기존 모달이 있다면 제거
      const existingModal = document.getElementById('rewardModal');
      if (existingModal) {
        existingModal.remove();
      }
      
      // 모달 생성
      const modal = document.createElement('div');
      modal.id = 'rewardModal';
      modal.style.position = 'fixed';
      modal.style.top = '0';
      modal.style.left = '0';
      modal.style.right = '0';
      modal.style.bottom = '0';
      modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
      modal.style.display = 'flex';
      modal.style.alignItems = 'center';
      modal.style.justifyContent = 'center';
      modal.style.zIndex = '1000';
      
      // 모달 컨텐츠 생성
      const content = document.createElement('div');
      content.style.backgroundColor = 'white';
      content.style.borderRadius = '8px';
      content.style.padding = '20px';
      content.style.width = '300px';
      content.style.maxWidth = '90%';
      content.style.textAlign = 'center';
      content.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
      
      // 아이콘 추가
      const iconElem = document.createElement('div');
      iconElem.className = 'modal-icon';
      iconElem.style.fontSize = '36px';  // 크기 제한
      iconElem.style.margin = '0 0 15px 0';
      iconElem.textContent = icon;
      content.appendChild(iconElem);
      
      // 제목 추가
      const titleElem = document.createElement('h3');
      titleElem.style.margin = '0 0 10px 0';
      titleElem.style.color = '#4569d4';
      titleElem.style.fontSize = '18px';
      titleElem.textContent = title;
      content.appendChild(titleElem);
      
      // 내용 추가
      const descElem = document.createElement('p');
      descElem.style.margin = '0 0 20px 0';
      descElem.style.color = '#333';
      descElem.textContent = `출석체크가 완료되었습니다!
보상: ${desc}`;
      content.appendChild(descElem);
      
      // 버튼 추가
      const button = document.createElement('button');
      button.style.backgroundColor = '#4569d4';
      button.style.color = 'white';
      button.style.border = 'none';
      button.style.padding = '10px 20px';
      button.style.borderRadius = '4px';
      button.style.cursor = 'pointer';
      button.style.fontSize = '14px';
      button.textContent = '확인';
      button.onclick = function() {
        modal.remove();
      };
      content.appendChild(button);
      
      // 모달 추가
      modal.appendChild(content);
      document.body.appendChild(modal);
    }
    
    // 일반 알림 함수
    function showCustomAlert(message, isSuccess = true) {
      // 기존 알림이 있다면 제거
      const existingAlert = document.getElementById('customAlert');
      if (existingAlert) {
        existingAlert.remove();
      }
      
      // 알림 생성
      const alertBox = document.createElement('div');
      alertBox.id = 'customAlert';
      alertBox.style.position = 'fixed';
      alertBox.style.top = '20px';
      alertBox.style.left = '50%';
      alertBox.style.transform = 'translateX(-50%)';
      alertBox.style.backgroundColor = isSuccess ? '#4caf50' : '#f44336';
      alertBox.style.color = 'white';
      alertBox.style.padding = '12px 24px';
      alertBox.style.borderRadius = '4px';
      alertBox.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';
      alertBox.style.zIndex = '1000';
      alertBox.style.minWidth = '200px';
      alertBox.style.textAlign = 'center';
      alertBox.textContent = message;
      
      // 문서에 추가
      document.body.appendChild(alertBox);
      
      // 3초 후 삭제
      setTimeout(() => {
        alertBox.remove();
      }, 3000);
    }
  </script>
</body>
</html>
