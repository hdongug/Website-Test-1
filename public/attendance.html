<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>게임 아이템 거래 플랫폼 - 출석체크</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; }
    .calendar-day { width: 14.285%; height: 100px; }
    .calendar-day.active { background-color: #EBF4FF; }
    .calendar-day.current { border: 2px solid #4F46E5; }
    .calendar-day.checked { background-color: #C7D2FE; }
  </style>
</head>
<body class="bg-gray-100">
  <nav class="bg-white shadow-lg">
    <div class="container mx-auto px-4">
      <div class="flex justify-between items-center h-16">
        <a href="index.html" class="flex items-center space-x-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14.5 17.5L3 6"/><path d="M13 19l6-1 1-6"/><path d="M16 16l5-5"/><path d="M14 14l-1.5 1.5"/><path d="M7 9l-1.5 1.5"/><path d="M3 19l3.5-3.5"/><path d="M19 3l-3.5 3.5"/><path d="M10 12l-1.5 1.5"/>
          </svg>
          <span class="text-xl font-bold text-gray-800">게임 거래소</span>
        </a>
        
        <div class="flex items-center space-x-6">
          <a href="market.html" class="flex items-center space-x-1 text-gray-600 hover:text-indigo-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14.5 17.5L3 6"/><path d="M13 19l6-1 1-6"/><path d="M16 16l5-5"/><path d="M14 14l-1.5 1.5"/><path d="M7 9l-1.5 1.5"/><path d="M3 19l3.5-3.5"/><path d="M19 3l-3.5 3.5"/><path d="M10 12l-1.5 1.5"/>
            </svg>
            <span>거래소</span>
          </a>
          <a href="forum.html" class="flex items-center space-x-1 text-gray-600 hover:text-indigo-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <span>게시판</span>
          </a>
          <a href="attendance.html" class="flex items-center space-x-1 text-indigo-600 font-medium">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <span>출석체크</span>
          </a>
          <a href="inventory.html" class="flex items-center space-x-1 text-gray-600 hover:text-indigo-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
            </svg>
            <span>창고</span>
          </a>
          
          <a href="profile.html" class="flex items-center space-x-1 text-gray-600 hover:text-indigo-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>사용자 정보</span>
          </a>
          
          <div id="authButton">
            <a href="/login.html" class="flex items-center space-x-1 text-gray-600 hover:text-indigo-600 bg-indigo-100 px-3 py-1 rounded-md">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                <polyline points="10 17 15 12 10 7"></polyline>
                <line x1="15" y1="12" x2="3" y2="12"></line>
              </svg>
              <span>로그인</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <div class="container mx-auto px-4 py-8">
    <div class="space-y-8">
      <div class="flex justify-between items-center">
        <h1 class="text-3xl font-bold text-gray-900">출석체크</h1>
        <p id="userStreak" class="text-lg text-indigo-600 font-medium">연속 출석일: <span id="streakCount">0</span>일</p>
      </div>

      <div class="bg-white p-6 rounded-lg shadow-md">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold text-gray-800" id="currentMonth">2025년 5월</h2>
          <div class="flex space-x-2">
            <button id="prevMonth" class="p-1 rounded-md hover:bg-gray-100">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <button id="nextMonth" class="p-1 rounded-md hover:bg-gray-100">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
          </div>
        </div>
        
        <div class="grid grid-cols-7 gap-1 text-center mb-2">
          <div class="font-medium text-red-500">일</div>
          <div class="font-medium">월</div>
          <div class="font-medium">화</div>
          <div class="font-medium">수</div>
          <div class="font-medium">목</div>
          <div class="font-medium">금</div>
          <div class="font-medium text-blue-500">토</div>
        </div>
        
        <div class="grid grid-cols-7 gap-1" id="calendarDays">
          <!-- 캘린더 날짜는 JavaScript로 동적 생성 -->
        </div>
      </div>

      <div class="bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">오늘의 출석체크</h2>
        
        <div id="attendanceStatus" class="mb-6">
          <!-- 비로그인 상태 -->
          <div id="notLoggedIn" class="">
            <p class="text-gray-600 mb-4">출석체크를 위해 로그인이 필요합니다.</p>
            <a href="/login.html" class="inline-block px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
              로그인하기
            </a>
          </div>
          
          <!-- 로그인 상태 & 출석체크 가능 -->
          <div id="canCheckIn" class="hidden">
            <p class="text-gray-600 mb-4">오늘 출석체크를 완료하면 <span class="font-semibold text-indigo-600">500 골드</span>를 받을 수 있습니다.</p>
            <button id="checkInButton" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
              출석체크 하기
            </button>
          </div>
          
          <!-- 로그인 상태 & 이미 출석체크 완료 -->
          <div id="alreadyCheckedIn" class="hidden">
            <div class="flex items-center text-green-600 mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
              </svg>
              <p class="font-medium">오늘은 이미 출석체크를 완료했습니다!</p>
            </div>
            <p class="text-gray-600">내일도 잊지 말고 출석체크하세요.</p>
          </div>
        </div>
        
        <div class="border-t pt-4">
          <h3 class="font-medium text-gray-800 mb-2">출석체크 보상</h3>
          <ul class="space-y-2 text-sm text-gray-600">
            <li class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-500 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                <line x1="9" y1="9" x2="9.01" y2="9"></line>
                <line x1="15" y1="9" x2="15.01" y2="9"></line>
              </svg>
              <span>매일 출석: 500 골드</span>
            </li>
            <li class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-500 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                <line x1="9" y1="9" x2="9.01" y2="9"></line>
                <line x1="15" y1="9" x2="15.01" y2="9"></line>
              </svg>
              <span>7일 연속 출석: 추가 1,000 골드 + 행운의 상자</span>
            </li>
            <li class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-500 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                <line x1="9" y1="9" x2="9.01" y2="9"></line>
                <line x1="15" y1="9" x2="15.01" y2="9"></line>
              </svg>
              <span>30일 연속 출석: 추가 5,000 골드 + 희귀 아이템 상자</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 로그인 상태 확인
      const userJson = localStorage.getItem('user');
      const authButton = document.getElementById('authButton');
      const notLoggedIn = document.getElementById('notLoggedIn');
      const canCheckIn = document.getElementById('canCheckIn');
      const alreadyCheckedIn = document.getElementById('alreadyCheckedIn');
      
      let attendanceData = JSON.parse(localStorage.getItem('attendance')) || {};
      let currentUser = null;
      
      if (userJson) {
        currentUser = JSON.parse(userJson);
        // 로그인 상태 처리
        authButton.innerHTML = `
          <button id="logoutBtn" class="flex items-center space-x-1 text-gray-600 hover:text-indigo-600 bg-gray-100 px-3 py-1 rounded-md">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            <span>로그아웃</span>
          </button>
        `;
        
        // 로그아웃 기능
        document.getElementById('logoutBtn').addEventListener('click', function() {
          localStorage.removeItem('user');
          alert('로그아웃되었습니다.');
          window.location.reload();
        });
        
        // 출석체크 상태 확인
        notLoggedIn.classList.add('hidden');
        
        // 사용자별 출석 데이터 가져오기
        const userId = currentUser.username;
        if (!attendanceData[userId]) {
          attendanceData[userId] = {
            dates: [],
            streak: 0,
            lastCheckIn: null
          };
        }
        
        // 오늘 날짜 체크
        const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD 형식
        
        if (attendanceData[userId].dates.includes(today)) {
          // 이미 출석체크 완료
          canCheckIn.classList.add('hidden');
          alreadyCheckedIn.classList.remove('hidden');
        } else {
          // 출석체크 가능
          canCheckIn.classList.remove('hidden');
          alreadyCheckedIn.classList.add('hidden');
        }
        
        // 연속 출석일 표시
        document.getElementById('streakCount').textContent = attendanceData[userId].streak;
        
        // 출석체크 버튼 이벤트
        document.getElementById('checkInButton').addEventListener('click', function() {
          // 출석체크 처리
          attendanceData[userId].dates.push(today);
          
          // 연속 출석 확인
          const yesterday = new Date();
          yesterday.setDate(yesterday.getDate() - 1);
          const yesterdayStr = yesterday.toISOString().split('T')[0];
          
          if (attendanceData[userId].dates.includes(yesterdayStr) || !attendanceData[userId].lastCheckIn) {
            attendanceData[userId].streak += 1;
          } else {
            attendanceData[userId].streak = 1; // 연속 출석이 끊겼으면 1로 리셋
          }
          
          attendanceData[userId].lastCheckIn = today;
          localStorage.setItem('attendance', JSON.stringify(attendanceData));
          
          // 보상 지급
          let reward = 500; // 기본 500 골드
          let message = `출석체크 완료! ${reward} 골드를 획득했습니다.`;
          
          // 연속 출석 보상
          if (attendanceData[userId].streak === 7) {
            reward += 1000;
            message = `7일 연속 출석 성공! ${reward} 골드와 행운의 상자를 획득했습니다.`;
          } else if (attendanceData[userId].streak === 30) {
            reward += 5000;
            message = `30일 연속 출석 대성공! ${reward} 골드와 희귀 아이템 상자를 획득했습니다!`;
          }
          
          // 골드 추가
          currentUser.balance = (parseInt(currentUser.balance) || 0) + reward;
          localStorage.setItem('user', JSON.stringify(currentUser));
          
          alert(message);
          window.location.reload();
        });
      } else {
        // 비로그인 상태
        notLoggedIn.classList.remove('hidden');
        canCheckIn.classList.add('hidden');
        alreadyCheckedIn.classList.add('hidden');
      }
      
      // 달력 생성 함수
      function generateCalendar(year, month) {
        const calendarDays = document.getElementById('calendarDays');
        calendarDays.innerHTML = '';
        
        document.getElementById('currentMonth').textContent = `${year}년 ${month+1}월`;
        
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        
        // 첫 주 빈 공간 채우기
        for (let i = 0; i < firstDay.getDay(); i++) {
          const emptyDay = document.createElement('div');
          emptyDay.className = 'calendar-day p-2';
          calendarDays.appendChild(emptyDay);
        }
        
        // 날짜 채우기
        const today = new Date();
        const currentDateStr = today.toISOString().split('T')[0];
        
        for (let i = 1; i <= lastDay.getDate(); i++) {
          const dayElement = document.createElement('div');
          dayElement.className = 'calendar-day p-2 border rounded-md';
          
          const dateObj = new Date(year, month, i);
          const dateStr = dateObj.toISOString().split('T')[0];
          
          // 현재 날짜 표시
          if (dateObj.getFullYear() === today.getFullYear() && 
              dateObj.getMonth() === today.getMonth() && 
              dateObj.getDate() === today.getDate()) {
            dayElement.classList.add('current');
          }
          
          // 출석체크 표시
          if (currentUser && attendanceData[currentUser.username] && 
              attendanceData[currentUser.username].dates.includes(dateStr)) {
            dayElement.classList.add('checked');
            dayElement.innerHTML = `
              <div class="flex flex-col h-full">
                <span class="text-sm font-semibold">${i}</span>
                <div class="mt-1 flex justify-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                  </svg>
                </div>
              </div>
            `;
          } else {
            dayElement.innerHTML = `<span class="text-sm font-semibold">${i}</span>`;
          }
          
          calendarDays.appendChild(dayElement);
        }
      }
      
      // 현재 월 표시
      const currentDate = new Date();
      let currentYear = currentDate.getFullYear();
      let currentMonth = currentDate.getMonth();
      
      generateCalendar(currentYear, currentMonth);
      
      // 이전/다음 달 버튼
      document.getElementById('prevMonth').addEventListener('click', function() {
        currentMonth--;
        if (currentMonth < 0) {
          currentMonth = 11;
          currentYear--;
        }
        generateCalendar(currentYear, currentMonth);
      });
      
      document.getElementById('nextMonth').addEventListener('click', function() {
        currentMonth++;
        if (currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        }
        generateCalendar(currentYear, currentMonth);
      });
    });
  </script>
</body>
</html>
